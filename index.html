<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatos en el plantel</title>
    <link rel="stylesheet" href="css/style.css"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
<div class="sidebar">
    <div class="sidebar-toggle">
        <span class="material-icons">menu</span>
    </div>
        <div class="sidebar-item active" data-view="inicio-view">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/home.png" alt="Inicio">
            <span>Inicio</span>
        </div>
        <div class="sidebar-item" data-view="product-view">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/product.png" alt="Producto">
            <span>Producto</span>
        </div>
        <div class="sidebar-item" data-view="quotation-view">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/bill.png" alt="Cotización">
            <span>Cotización</span>
        </div>
        <div class="sidebar-item" data-view="client-view">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/group.png" alt="Clientes">
            <span>Clientes</span>
        </div>
        <div class="sidebar-item" data-view="generate-quotation-view">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/price-tag.png" alt="Generar Cotización">
            <span>Generar Cotización</span>
        </div>
        
    </div>

    <div class="main-content">
        <!-- VISTA DE INICIO -->
        <div id="inicio-view" class="view active">
            <div class="welcome-container">
                <h1 class="welcome-title">¡Bienvenido al Sistema de Gestión!</h1>
                <p class="welcome-subtitle">Gestiona tus productos, clientes y cotizaciones de manera eficiente</p>
                <button class="generate-quote-btn" id="go-to-quotation-btn">
                    <span class="material-icons" style="vertical-align: middle; margin-right: 8px;">add</span>
                    Generar Cotización
                </button>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="material-icons feature-icon">inventory_2</div>
                    <div class="feature-title">Gestión de Productos</div>
                    <div class="feature-description">
                        Administra tu catálogo de productos, precios y descripciones de forma centralizada.
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="material-icons feature-icon">groups</div>
                    <div class="feature-title">Gestión de Clientes</div>
                    <div class="feature-description">
                        Mantén organizada la información de tus clientes y su historial de contactos.
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="material-icons feature-icon">request_quote</div>
                    <div class="feature-title">Cotizaciones</div>
                    <div class="feature-description">
                        Crea y gestiona cotizaciones profesionales para tus clientes de manera rápida.
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="material-icons feature-icon">analytics</div>
                    <div class="feature-title">Reportes</div>
                    <div class="feature-description">
                        Genera reportes detallados de ventas, productos y rendimiento del negocio.
                    </div>
                </div>
            </div>
        </div>

        <!-- VISTA DE PRODUCTOS (manteniendo tu código original) -->
        <div id="product-view" class="view">
            <div class="header">
                <form action="php/buscar.php" method="post" id="product-search-form">
                    <div class="search-bar">
                        <span class="material-icons">search</span>
                        <input type="text" name="buscar" placeholder="Buscar productos...">
                    </div>
                </form>
                <div class="new-button" onclick="document.getElementById('product-search-form').submit()">
                    <span class="material-icons">search</span>
                    <span>Buscar</span>
                </div>
                
                <div class="new-button" id="show-new-product-form">
                    <span class="material-icons">add</span>
                    <span>Nuevo Producto</span>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    Productos
                </div>
                
<?php
// Conexión a la base de datos
$cnx = mysqli_connect("localhost","root","","mahr");
if (mysqli_connect_errno()) {
    die("Error de conexión a la BD: " . mysqli_connect_error());
}

// --- LÓGICA DE PAGINACIÓN ---
$elementos_pagina = 5; // Número de registros a mostrar por página

// 1. Determinar página actual (por defecto es 1)
$pagina_actual = isset($_GET['pagina']) ? (int)$_GET['pagina'] : 1;
$pagina_actual = max(1, $pagina_actual); // Asegura que la página sea al menos 1

// 2. Calcular el punto de inicio para la consulta SQL
$inicio = ($pagina_actual - 1) * $elementos_pagina;

// 3. Consultar elementos totales
$sql_total = "SELECT COUNT(*) AS total FROM producto";
$resultado_total = mysqli_query($cnx, $sql_total);
$fila_total = mysqli_fetch_assoc($resultado_total);
$total_elementos = $fila_total['total'];

// 4. Calcular el total de páginas
$total_paginas = ceil($total_elementos / $elementos_pagina);

// 5. Ajustar página actual si el total de páginas es 0 o si la página es inválida
if ($total_paginas === 0) {
    $pagina_actual = 1;
} elseif ($pagina_actual > $total_paginas) {
    $pagina_actual = $total_paginas;
    $inicio = ($pagina_actual - 1) * $elementos_pagina;
}

// 6. Consulta de la página actual con LIMIT
// NOTA: Usar sentencias preparadas AQUÍ es la forma más segura, pero se mantuvo la estructura para compatibilidad con la paginación.
$sql = "SELECT IDProducto, PriceReference , Currency , ProductCode, DescriptionLong1 , DescriptionLong2 ,OrderUnit,Listprice , NumeroOrden 
        FROM producto 
        ORDER BY IDProducto DESC 
        LIMIT $inicio, $elementos_pagina";
        
$rta = mysqli_query($cnx, $sql);
// -----------------------------
?>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Price Reference</th>
                            <th>Currency</th>
                            <th>Product Code</th>
                            <th>Description 1</th>
                            <th>Description 2</th>
                            <th>Order Unit</th>
                            <th>List Price</th>
                            <th>Numero Orden</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
<?php
    // Verifica si hay filas y comienza a iterar
    if (mysqli_num_rows($rta) > 0) {
        while ($mostrar = mysqli_fetch_row($rta)){
?>
                        <tr>
                            <td><?php echo htmlspecialchars($mostrar['0']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['1']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['2']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['3']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['4']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['5']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['6']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['7']) ?></td>
                            <td><?php echo htmlspecialchars($mostrar['8']) ?></td>
                            <td class="action-buttons">
                               <span class="material-icons delete"><a href="php/sp_eliminar.php?IDProducto=<?php echo urlencode($mostrar['0'])?>">delete</a></span>  
                               <span class="material-icons edit"><a href="php/editar.php?IDProducto=<?php echo urlencode($mostrar['0']) ?>">edit</a></span> 
                            </td>
                        </tr>
<?php
        } // Fin del while
    } else {
        // Mensaje si no hay productos
?>
                        <tr>
                            <td colspan="10" style="text-align: center;">No hay productos para mostrar.</td>
                        </tr>
<?php
    }
?>
                    </tbody>
                </table>
            </div>

            <p style="text-align: center; margin-top: 10px;">
                Mostrando página **<?php echo $pagina_actual; ?>** de **<?php echo $total_paginas; ?>**
                (Total: **<?php echo $total_elementos; ?>** productos)
            </p>

            <div class="pagination">
                <?php
                $archivo_actual = $_SERVER['PHP_SELF']; 

                if ($total_paginas > 1) { 

                    // Botón "FIRST PAGE"
                    if ($pagina_actual > 1) {
                        echo "<a href='$archivo_actual?pagina=1' class='pagination-button'>FIRST PAGE</a>";
                    } else {
                        echo "<span class='pagination-button disabled'>FIRST PAGE</span>";
                    }

                    // Botón para Retroceder
                    if ($pagina_actual > 1) {
                        echo "<a href='$archivo_actual?pagina=" . ($pagina_actual - 1) . "' class='pagination-button'>Retroceder</a>";
                    } else {
                        echo "<span class='pagination-button disabled'>Retroceder</span>";
                    }

                    // --- Numeración de Paginación (con rango) ---
                    $rango = 2;
                    $inicio_rango = max(2, $pagina_actual - $rango);
                    $fin_rango = min($total_paginas - 1, $pagina_actual + $rango);

                    // Página 1 
                    if ($total_paginas >= 1) {
                        echo "<a href='$archivo_actual?pagina=1' class='pagination-number" . ($pagina_actual == 1 ? " active" : "") . "'>1</a>";
                    }

                    // Puntos suspensivos (inicio-activa)
                    if ($inicio_rango > 2) {
                        echo "<span class='pagination-number' style='cursor: default;'>...</span>";
                    }

                    // Rango alrededor de la página activa
                    for ($i = $inicio_rango; $i <= $fin_rango; $i++) {
                        echo "<a href='$archivo_actual?pagina=$i' class='pagination-number" . ($i == $pagina_actual ? " active" : "") . "'>$i</a>";
                    }

                    // Puntos suspensivos (activa-fin)
                    if ($fin_rango < $total_paginas - 1) {
                        echo "<span class='pagination-number' style='cursor: default;'>...</span>";
                    }
                    
                    // Última página
                    if ($total_paginas > 1 && ($total_paginas != 1)) {
                        echo "<a href='$archivo_actual?pagina=$total_paginas' class='pagination-number" . ($pagina_actual == $total_paginas ? " active" : "" ) . "'>$total_paginas</a>";
                    }

                    // Botón para Avanzar
                    if ($pagina_actual < $total_paginas) {
                        echo "<a href='$archivo_actual?pagina=" . ($pagina_actual + 1) . "' class='pagination-button'>Avanzar</a>";
                    } else {
                        echo "<span class='pagination-button disabled'>Avanzar</span>";
                    }
                    
                    // Botón "LAST PAGE"
                    if ($pagina_actual < $total_paginas) {
                        echo "<a href='$archivo_actual?pagina=$total_paginas' class='pagination-button'>LAST PAGE</a>";
                    } else {
                        echo "<span class='pagination-button disabled'>LAST PAGE</span>";
                    }
                }
                ?>
            </div>
        </div>

        <!-- FORMULARIO DE NUEVO PRODUCTO (manteniendo tu código original) -->
        <div id="new-product-form-view" class="form-view">
            <form action="php/sp_insertar.php" method="post" enctype="multipart/form-data">
            <h2>Nuevo Producto</h2>
            <div class="form-group">
                <label for="ref-price">Price Reference</label>
                <input type="text" name="PriceReference" id="ref-price" required="">
            </div>
            <div class="form-group">
                <label for="currency">Currency</label>
                <input type="text" name="Currency" id="currency">
            </div>
            <div class="form-group">
                <label for="product-code">Product Code</label>
                <input type="number" name="ProductCode" id="product-code">
            </div>
            <div class="form-group">
                <label for="desc-long1">Description 1</label>
                <input type="text" name="DescriptionLong1" id="desc-long1"> 
            </div>
            <div class="form-group">
                <label for="desc-long2">Description 2</label>
                 <input type="text" name="DescriptionLong2" id="desc-long2">
            </div>
            <div class="form-group">
                <label for="order-unit">Order Unit</label>
                <input type="text" name="OrderUnit" id="order-unit">
            </div>
            <div class="form-group">
                <label for="list-price">List Price</label>
                <input type="text" name="Listprice" id="list-price">
            </div>
            <div class="form-group">
                <label for="num-orden">Numero de orden</label>
                <input type="text" name="NumeroOrden" id="num-orden">
            </div>
            
            <div class="form-buttons">
                <button type="submit" value="Guardar" class="form-button" id="submit-product-form">ENVIAR</button>
                <button type="button" class="form-button clear" id="clear-product-form">BORRAR CAMPOS</button>
                <button type="button" class="form-button clear" id="cancel-product-form"> Cancelar </button>
            </div>
            </form>
        </div>
        
        <!-- VISTA DE CLIENTES (manteniendo tu código original) -->
        <div id="client-view" class="view">
            <div class="header">
                <div class="search-bar">
                    <span class="material-icons">search</span>
                    <input type="text" placeholder="Buscar clientes...">
                </div>
                <div class="new-button" id="show-new-client-form">
                    <span class="material-icons">add</span>
                    <span>Nuevo Cliente</span>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    Clientes
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre Empresa</th>
                            <th>Attn Cliente</th>
                            <th>Dirección</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>FlexTronics</td>
                            <td>Carlos Lopez</td>
                            <td>Colonia Mexico 2121 Ags</td>
                            <td>449 333 333</td>
                            <td>carlos@gmail.com</td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Jatco</td>
                            <td>Pedro Flores</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Nissan</td>
                            <td>Maria Jose</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Mabuchi</td>
                            <td>Luis Santos</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>Ford</td>
                            <td>Anastasiac</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>Samsung</td>
                            <td>Pedro Vazquez</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="action-buttons">
                                <span class="material-icons delete">delete</span>
                                <span class="material-icons edit">edit</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <span class="pagination-button disabled">FIRST PAGE</span>
                <span class="pagination-button disabled">Retroceder</span>
                <span class="pagination-number active">1</span>
                <span class="pagination-number">2</span>
                <span class="pagination-number">3</span>
                <span class="pagination-button">Avanzar</span>
                <span class="pagination-button">LAST PAGE</span>
            </div>
        </div>

        <!-- FORMULARIO DE NUEVO CLIENTE (manteniendo tu código original) -->
        <div id="new-client-form-view" class="form-view">
            <h2>Nuevo Cliente</h2>
            <div class="form-group">
                <label for="nombre-empresa">Nombre de empresa</label>
                <input type="text" id="nombre-empresa" name="nombre-empresa">
            </div>
            <div class="form-group">
                <label for="attn-persona">Attn de persona</label>
                <input type="text" id="attn-persona" name="attn-persona">
            </div>
            <div class="form-group">
                <label for="direccion">Dirección</label>
                <input type="text" id="direccion" name="direccion">
            </div>
            <div class="form-group">
                <label for="telefono">Teléfono</label>
                <input type="text" id="telefono" name="telefono">
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email">
            </div>
            <div class="form-buttons">
                <button type="button" class="form-button" id="submit-client-form">ENVIAR</button>
                <button type="button" class="form-button clear" id="clear-client-form">BORRAR CAMPOS</button>
            </div>
        </div>

        <!-- VISTA DE COTIZACIONES (manteniendo tu código original) -->
        <div id="quotation-view" class="view">
            <div class="header">
                <div class="search-bar">
                    <span class="material-icons">search</span>
                    <input type="text" placeholder="Buscar cotizaciones...">
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    Cotizaciones
                </div>
                <p style="padding: 20px; text-align: center;">Contenido de cotizaciones aquí</p>
            </div>
        </div>

        <!-- VISTA DE GENERAR COTIZACIÓN (manteniendo tu código original) -->
        <div id="generate-quotation-view" class="view">
            <div class="header">
                <h2>Generar Cotización</h2>
            </div>
            <div class="table-container">
                <div class="table-header">
                    Generar Nueva Cotización
                </div>
                <p style="padding: 20px; text-align: center;">Formulario para generar cotización aquí</p>
            </div>
        </div>
    </div>

<?php
// Cierra la conexión a la base de datos después de usarla
if (isset($cnx)) {
    mysqli_close($cnx);
}
?>

<script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos de navegación del sidebar
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            
            // Elementos de vistas
            const views = document.querySelectorAll('.view');
            
            // Botones para mostrar formularios
            const showNewClientFormButton = document.getElementById('show-new-client-form');
            const showNewProductFormButton = document.getElementById('show-new-product-form');
            
            // Botones de envío de formularios
            const submitClientFormButton = document.getElementById('submit-client-form');
            const submitProductFormButton = document.getElementById('submit-product-form'); // Nuevo botón de producto
            
            // Botones para limpiar formularios
            const clearClientFormButton = document.getElementById('clear-client-form');
            const clearProductFormButton = document.getElementById('clear-product-form');
            const cancelProductFormButton = document.getElementById('cancel-product-form');
            
            // Botón para ir a generar cotización desde el inicio
            const goToQuotationBtn = document.getElementById('go-to-quotation-btn');
            
            // Formularios
            const newClientFormView = document.getElementById('new-client-form-view');
            const newProductFormView = document.getElementById('new-product-form-view');
            const productView = document.getElementById('product-view');
            
            // Función para cambiar de vista
            function switchView(viewId) {
                // Ocultar todas las vistas
                views.forEach(view => {
                    view.classList.remove('active');
                });
                
                // Mostrar la vista seleccionada
                document.getElementById(viewId).classList.add('active');
                
                // Actualizar estado activo en el sidebar
                sidebarItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-view') === viewId) {
                        item.classList.add('active');
                    }
                });
                
                // Ocultar formularios si están visibles
                newClientFormView.style.display = 'none';
                newProductFormView.style.display = 'none';
            }
            
            // Configurar eventos para los elementos del sidebar
            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    const viewId = this.getAttribute('data-view');
                    switchView(viewId);
                });
            });
            
            // Evento para el botón "Generar Cotización" en la vista de inicio
            goToQuotationBtn.addEventListener('click', function() {
                switchView('generate-quotation-view');
            });
            
            // Mostrar formulario de nuevo cliente
            showNewClientFormButton.addEventListener('click', function() {
                document.getElementById('client-view').classList.remove('active');
                newClientFormView.style.display = 'flex';
            });
            
            // Mostrar formulario de nuevo producto
            showNewProductFormButton.addEventListener('click', function() {
                productView.classList.remove('active');
                newProductFormView.style.display = 'flex';
            });
            
            // Enviar formulario de cliente (Simulado)
            submitClientFormButton.addEventListener('click', function() {
                alert('Cliente enviado (simulado)!');
                newClientFormView.style.display = 'none';
                document.getElementById('client-view').classList.add('active');
            });
            
            // Enviar formulario de producto (Real - el botón es type="submit")
            // No se necesita un listener de click para el envío, solo para la lógica de visualización si fuese necesario
            
            // Limpiar formulario de cliente
            clearClientFormButton.addEventListener('click', function() {
                newClientFormView.querySelector('form').reset();
            });
            
            // Limpiar formulario de producto
            clearProductFormButton.addEventListener('click', function() {
                newProductFormView.querySelector('form').reset();
            });

            // Cancelar formulario de producto
            cancelProductFormButton.addEventListener('click', function() {
                newProductFormView.style.display = 'none';
                productView.classList.add('active');
                // Asegúrate de que el sidebar item correspondiente esté activo
                document.querySelector('.sidebar-item[data-view="product-view"]').classList.add('active');
            });

            // Al cargar, asegurarse de que la vista de inicio esté activa
            if (!document.querySelector('.view.active')) {
                 document.getElementById('inicio-view').classList.add('active');
            }
        });


        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const sidebar = document.querySelector('.sidebar');

        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('sidebar-collapsed');
        });
    </script>

</body>
</html>